FROM openjdk:11-jre-slim

ARG JAR_FILE=./build/libs/*.jar
ARG PROFILE
ARG DDL_AUTO
ARG DB_URL
ARG DB_USERNAME
ARG DB_PASSWORD
ARG MAIL_USERNAME
ARG MAIL_PASSWORD
ARG ESTIMATE_LINK
ARG SERVER_URL
ARG REDIS_URL
ARG REDIS_PORT
ARG BATCH_FETCH_SIZE

COPY ${JAR_FILE} app.jar
COPY config/pinpoint-agent pinpoint-agent
COPY start-app.sh /start-app.sh

ENV PROFILE=${PROFILE}
ENV DDL_AUTO=${DDL_AUTO}
ENV DB_URL=${DB_URL}
ENV DB_USERNAME=${DB_USERNAME}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV PINPOINT_AGENT_ID=${PINPOINT_AGENT_ID}
ENV MAIL_USERNAME=${MAIL_USERNAME}
ENV MAIL_PASSWORD=${MAIL_PASSWORD}
ENV ESTIMATE_LINK=${ESTIMATE_LINK}
ENV SERVER_URL=${SERVER_URL}
ENV REDIS_URL=${REDIS_URL}
ENV REDIS_PORT=${REDIS_PORT}
ENV BATCH_FETCH_SIZE=${BATCH_FETCH_SIZE}
ENV TZ=Asia/Seoul

RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
RUN chmod +x /start-app.sh

EXPOSE 8080
EXPOSE 9292
ENTRYPOINT ["/start-app.sh"]
